---
layout: post
title: Node.js
tags:
- nodejs
- javascript
---


서버 측 자바스크립트와 Nodejs

[생활코딩](https://opentutorials.org/course/2136/11850){:target="_blank"}

내용정리 (포스팅 진행중)

---

### NodeJs

Chrome V8 JavaScript 엔진으로 빌드된 JavaScript 런타임

확장성있는 네트워크 애플리케이션을 만들 수 있다.


구글의 V8 엔진을 자바스크립트 엔진으로 사용 + event-driven 자바스크립트 개발방식 + non blocking IO 입출력 처리

웹브라우저가 아닌 서버쪽에서도 동작하는 자바스크립트로 확장



---

#### 연결성 javscript & nodejs

FS, HTTP, OS 등 nodejs가 기본적으로 제공하는 기능들을 자바스크립트 프로그래밍 언어의 문법에 맞게 의도하는 바에 해당되는 프로그램을 만든다.


#### Module NPM

Module : 부품으로 사용될 작은 프로그램들

ex) Express, Underscore, Jade


NPM을 통해 애플리케이션에 담아서 다양한 애플리케이션을 만들 수 있다.


#### Router & Controller (라우터 & 컨트롤러)

controller  컨트롤러 : 회원가입, 홈페이지, 에러화면 등

Router 라우터 : 사용자의 요청을 어떤 컨트롤러에 전달해 줄 것인가 하는 중개자의 역할

ex) app.get

```javascript
app.get('/', function(req, res){
	res.send('hello~');
});
app.get('/dynamic', function(req,res){
	res.send('dynamic');
});
```

메인 '/' 페이지에 들어왔을때 'hello~' 출력

/dynamic 페이지에 들어왔을때 'dynamic' 출력


---



#### nodejs 설치
[nodejs.org](https://nodejs.org/ko/){:target="_blank"}


webserver.js
```javascript
const http = require('http');
 
const hostname = '127.0.0.1';
const port = 1337;
 
var server = http.createServer(function(req, res){
	res.writeHead(200, { 'Content-Type': 'text/plain' });
	res.end('Hello World\n');
});
server.listen(port, hostname, function(){
	console.log(`Server running at http://${hostname}:${port}/`);
});
```



#### 실행

cmd 

cd.. : 상위폴더로 이동

cd foldername : 하위폴더로 이동

ctrl + c : 빠져나오기

↑ : 이전 작성  코드 불러오기

node webserver.js

node app.js

---

#### var (variable) 변수


#### const (constant) 상수

한번 할당이 되면 그다음부터 값을 바꿀수없는 상수


---

### Node Package Manager (NPM)

node계의 앱스토어

설치/삭제/업그레이드/의존성 관리


---

```javascript
npm install uglify-js -g

//save
uglifyjs pretty.js -o pretty.min.js -m
```

#### npm 설치시 플래그 옵션 --save 

dependencies 가 붙음

의존성, 온전하게 포함

어떠한 모듈을 프로젝트에 포함시키는 방법

새로운 폴더에 이 프로젝트를 다시 시작한다고 하더라도 디펜던시에 있는 모듈을 쉽게 가져올 수 있다.


---


#### npm init

프로젝트 처음 시작시 현재 디렉토리를 npm의 디렉토리로 지정

package.json 파일이 생성됨

---

```javascript
var _ = require('underscore');
var arr = [3,6,9,12];

console.log(_.first(arr));
```


### Express

노드를 이용해서 만들어진 웹 프레임워크

웹애플리케이션 구축

[Express.com](http://expressjs.com/ko/starter/hello-world.html){:target="_blank"}



#### 설치

npm install express --save


---

#### app.js 생성

메인파일, 메인애플리케이션, 엔트리 애플리케이션

최초의 진입점이 되는 메인 애플리케이션 생성

myapp 디렉토리에 app.js라는 이름의 파일을 작성한 후 다음과 같은 코드를 추가


app.js

```javascript
var express = require('express');
var app = express();

app.get('/', function (req, res) {
  res.send('Hello World!');
});

app.listen(3000, function () {
  console.log('Example app listening on port 3000!');
});
```



#### 정적파일 재공

```javascript
app.use(express.static('public'));
```

---

#### 동적파일과 정적파일

app.js

```javascript
var express = require('express');
var app = express();
app.use(express.static('public'));
app.get('/', function(req, res){
	res.send('hello~');
});
app.get('/dynamic', function(req,res){
	var lis = '';
	for(var i=0; i<5; i++){
		lis = lis + '<li>coding</li>';
	}
	var time = Date();
	var output = `<!doctype html>
	<html lang="ko">
	<head>
		<meta charset="UTF-8">
		<title>Document</title>
	</head>
	<body>

		hello dynamic!

		<ul>
		${lis}
		</ul>

		${time}

	</body>
	</html>`;
	res.send(output);
});
app.get('/route', function(req, res){
	res.send('hello router, <img src="/Lighthouse.jpg">');
});
app.get('/login', function(req, res){
	res.send('login please');
});
app.listen(3000, function(){
	console.log('connented 3000 port!');
});
```


---

### jade 템플릿엔진

npm install jade --save


#### express 템플릿 렌더링설정

```javascript
app.set('view engine', 'jade');
app.set('views','./views');
```



#### 렌더링할 라우트작성

```javascript
app.get('/template', function(req, res){
	res.render('temp');
});
```


코드를 보기좋게 바꿔줌

```javascript
app.locals.pretty = true;
```

#### 템플릿 엔진 Jade 사용법과 문법

반복문 사용시 앞에 -를 붙여야함

```javascript
html
	head
	body
		h1 hello Jade
		ul
			-for(var i=0; i<5; i++)
				li coding
		div= time
```

#### div= time

time 은 변수

app.js에 현재 시간을 정의

```javascript
app.get('/template', function(req, res){
	res.render('temp', {time:Date()});
});
```


---

#### query strin (쿼리 스트링)

쿼리스트링은 어떤 애플리케이션에게 정보를전달할때 사용하는 url의 약속되어 있는 국제적인 표준

쿼리스트링으로 전달된 값은 request 영역

같은 패스 안에서 쿼리스트링 id값에 따라서 다른 결과를 전달


ex) http://a.com/topic?id=3

?id=3 


```javascript
app.get('/topic', function(req, res){
	res.send(req.query.id);
});
```

#### req.query

This property is an object containing a property for each query string parameter in the route. If there is no query string, it is the empty object, {}.


request 객체가 갖고 잇는 쿼리라는 객체의 id라는 property를 통해서 사용자가 쿼리스트링으로 접속할 때 전달한 정보를 사용할 수 있다.

사용자가 topic?id=3 을 치고 들어왓을때 이것은 요청임

req / request 정보

---

복수의 값도 받아 올 수 있음

쿼리스트링을 통해서 애플리케이션에게 전달할 수 있는 값은 여러개 일 수 있다.

?로 시작 &로 연결


```javascript
app.get('/topic', function(req, res){
	res.send(req.query.id+','+req.query.name);
});
```

http://localhost:3000/topic?id=1&name=song 로 접속했을때

id와 name 인 1,song 을 사용자에게 전송함


---

#### query 객체의 활용

```javascript
app.get('/topic', function(req, res){
	var topics = [
		'Javascript is....',
		'Node js is...',
		'Express is...'
	];
	res.send(topics[req.query.id]);
});
```

배열에 담고 해당 쿼리스트링 값을 받아와서 출력


---


#### 링크 클릭 동적으로 보여주기

```javascript
app.get('/topic', function(req, res){
	var topics = [
		'Javascript is....',
		'Node js is...',
		'Express is...'
	];
	var output = `
		<a href="/topic?id=0">Javascript</a><br>
		<a href="/topic?id=1">Nodejs</a><br>
		<a href="/topic?id=2">Express</a><br><br>
		${topics[req.query.id]}
	`
	res.send(output);
});
```


---

#### Semantic URL (시멘틱 URL)

시멘틱(의미론적) 웹

쿼리스트링이 없이 깔끔한 url을 통해 애플리케이션을 제어 할 수 있음

의미에 좀 더 부합되는 URL체계


```javascript
app.get('/topic/:id', function(req, res){
	var topics = [
		'Javascript is....',
		'Node js is...',
		'Express is...'
	];
	var output = `
		<a href="/topic?id=0">Javascript</a><br>
		<a href="/topic?id=1">Nodejs</a><br>
		<a href="/topic?id=2">Express</a><br><br>
		${topics[req.params.id]}
	`
	res.send(output);
});
```

topics/:id 

어떠한 값이 오는 경우에 잡아줌

100으로 해도 1000으로 해도...


#### params

parameter 파라미터

뒤에 오는 정보를 알아낼 수 있는 방법

```javascript
${topics[req.params.id]}
```

path방식인 semantic URL을 사용하는 경우 params 를 사용


---

http://localhost:3000/topic/1/edit

```javascript
app.get('/topic/:id/:node', function(req, res){
	res.send(req.params.id+','+req.params.node);
});
```

1, edit 출력

